@using Symphony.BlazorServerApp.Services.SubjectServices.Model
@using Symphony.BlazorServerApp.Services.SubjectServices
@using System
@using System.IO
@using Microsoft.AspNetCore.Hosting
@using Microsoft.Extensions.Logging

@inject ILogger<FileComponent> Logger
@inject IWebHostEnvironment Environment
@inject ISubjectService subjectService

<div class="col-lg-12">
    <label class="form-label fw-bold">@LabelName <span class="text-danger fw-bold">*</span></label>
    <InputFile OnChange="AddFiles" class="form-control" accept=".docx, .doc, .xlsx, .pdf, .pptx" multiple />
    @*<ValidationMessage For="@(() => Input.attachments)" />*@
</div>

@code {
    #region parameter
    [Parameter]
    public string LabelName { get; set; }
    #endregion

    #region constant

    private const long maxFileSize = 1024 * 15;
    private const int maxAllowedFiles = 3;

    #endregion

    private async Task AddFiles(InputFileChangeEventArgs e)
    {
        try
        {
            using Stream fileStream = e.File.OpenReadStream(maxAllowedSize: maxFileSize);

            using MemoryStream ms = new();
            await fileStream.CopyToAsync(ms);

            var content = new MultipartFormDataContent
{
                {
                    new ByteArrayContent(ms.ToArray()),
                    "\"file\"",
                    e.File.Name
                }
            };

            File = content;
        }
        catch (Exception exeption)
        {
            Console.WriteLine(exeption.Message);
        }
    }

}
